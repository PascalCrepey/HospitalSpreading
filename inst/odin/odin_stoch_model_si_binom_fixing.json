{"version":"1.4.5","config":{"base":"odin_stoch_model_si_binom_fixing","include":null,"custom":null},"meta":{"internal":"internal","user":"user","state":"state","result":"state_next","output":"output","time":"step","initial_time":"initial_step"},"features":{"continuous":false,"discrete":true,"mixed":false,"has_array":true,"has_output":true,"has_user":true,"has_delay":false,"has_interpolate":false,"has_stochastic":true,"has_include":false,"has_debug":false,"initial_time_dependent":false},"data":{"elements":[{"name":"beta","location":"internal","storage_type":"double","rank":0,"dimnames":null,"stage":"user"},{"name":"d","location":"internal","storage_type":"double","rank":2,"dimnames":{"length":"dim_d","dim":["dim_d_1","dim_d_2"],"mult":["","dim_d_1"]},"stage":"user"},{"name":"d_prob_out","location":"internal","storage_type":"double","rank":2,"dimnames":{"length":"dim_d_prob_out","dim":["dim_d_prob_out_1","dim_d_prob_out_2"],"mult":["","dim_d_prob_out_1"]},"stage":"user"},{"name":"dim_d","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_d_1","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_d_2","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_d_prob_out","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_d_prob_out_1","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_d_prob_out_2","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_I","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_i_initial","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_I_temp","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_N","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_new_I","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_S","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_s_initial","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_S_temp","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I_1","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I_2","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I_out","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S_1","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S_2","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S_out","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"I","location":"variable","storage_type":"double","rank":1,"dimnames":{"length":"dim_I","dim":[],"mult":[]},"stage":"time"},{"name":"i_initial","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_i_initial","dim":[],"mult":[]},"stage":"user"},{"name":"I_temp","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_I_temp","dim":[],"mult":[]},"stage":"time"},{"name":"initial_I","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_I","dim":[],"mult":[]},"stage":"user"},{"name":"initial_S","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_S","dim":[],"mult":[]},"stage":"user"},{"name":"N","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_N","dim":[],"mult":[]},"stage":"time"},{"name":"n_hospitals","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"new_I","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_new_I","dim":[],"mult":[]},"stage":"time"},{"name":"S","location":"variable","storage_type":"double","rank":1,"dimnames":{"length":"dim_S","dim":[],"mult":[]},"stage":"time"},{"name":"s_initial","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_s_initial","dim":[],"mult":[]},"stage":"user"},{"name":"S_temp","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_S_temp","dim":[],"mult":[]},"stage":"time"},{"name":"t_I","location":"internal","storage_type":"double","rank":2,"dimnames":{"length":"dim_t_I","dim":["dim_t_I_1","dim_t_I_2"],"mult":["","dim_t_I_1"]},"stage":"time"},{"name":"t_I_out","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_t_I_out","dim":[],"mult":[]},"stage":"time"},{"name":"t_S","location":"internal","storage_type":"double","rank":2,"dimnames":{"length":"dim_t_S","dim":["dim_t_S_1","dim_t_S_2"],"mult":["","dim_t_S_1"]},"stage":"time"},{"name":"t_S_out","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_t_S_out","dim":[],"mult":[]},"stage":"time"}],"variable":{"length":["+","dim_I","dim_S"],"contents":[{"name":"S","offset":0,"initial":"initial_S"},{"name":"I","offset":"dim_S","initial":"initial_I"}]},"output":{"length":["+","dim_new_I","dim_t_I"],"contents":[{"name":"new_I","offset":0},{"name":"t_I","offset":"dim_new_I"}]}},"equations":[{"name":"alloc_d_prob_out","type":"alloc","source":[25],"depends":{"functions":[],"variables":["dim_d_prob_out"]},"lhs":"d_prob_out"},{"name":"alloc_I_temp","type":"alloc","source":[17],"depends":{"functions":[],"variables":["dim_I_temp"]},"lhs":"I_temp"},{"name":"alloc_initial_I","type":"alloc","source":[13],"depends":{"functions":[],"variables":["dim_I"]},"lhs":"initial_I"},{"name":"alloc_initial_S","type":"alloc","source":[12],"depends":{"functions":[],"variables":["dim_S"]},"lhs":"initial_S"},{"name":"alloc_N","type":"alloc","source":[14],"depends":{"functions":[],"variables":["dim_N"]},"lhs":"N"},{"name":"alloc_new_I","type":"alloc","source":[19],"depends":{"functions":[],"variables":["dim_new_I"]},"lhs":"new_I"},{"name":"alloc_S_temp","type":"alloc","source":[16],"depends":{"functions":[],"variables":["dim_S_temp"]},"lhs":"S_temp"},{"name":"alloc_t_I","type":"alloc","source":[27],"depends":{"functions":[],"variables":["dim_t_I"]},"lhs":"t_I"},{"name":"alloc_t_I_out","type":"alloc","source":[29],"depends":{"functions":[],"variables":["dim_t_I_out"]},"lhs":"t_I_out"},{"name":"alloc_t_S","type":"alloc","source":[26],"depends":{"functions":[],"variables":["dim_t_S"]},"lhs":"t_S"},{"name":"alloc_t_S_out","type":"alloc","source":[28],"depends":{"functions":[],"variables":["dim_t_S_out"]},"lhs":"t_S_out"},{"name":"beta","type":"user","source":[5],"depends":null,"lhs":"beta","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"d","type":"user","source":[9],"depends":{"functions":["dim"],"variables":["dim_d"]},"lhs":"d","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"d_prob_out","type":"expression_array","source":[39],"depends":{"functions":["dim","/","[","odin_sum"],"variables":["dim_d_prob_out","d","i","j","dim_d","alloc_d_prob_out"]},"lhs":"d_prob_out","rhs":[{"index":[{"value":[":",1,["dim","d_prob_out",1]],"is_range":true,"index":"i"},{"value":[":",1,["dim","d_prob_out",2]],"is_range":true,"index":"j"}],"value":["/",["[","d","i","j"],["odin_sum","d","i","i",1,["dim","d",2]]]}]},{"name":"dim_d","type":"expression_scalar","source":[24],"depends":{"functions":[],"variables":["dim_d_1","dim_d_2"]},"lhs":"dim_d","rhs":{"value":["*","dim_d_1","dim_d_2"]}},{"name":"dim_d_1","type":"expression_scalar","source":[24],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_d_1","rhs":{"value":"n_hospitals"}},{"name":"dim_d_2","type":"expression_scalar","source":[24],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_d_2","rhs":{"value":"n_hospitals"}},{"name":"dim_d_prob_out","type":"expression_scalar","source":[25],"depends":{"functions":[],"variables":["dim_d_prob_out_1","dim_d_prob_out_2"]},"lhs":"dim_d_prob_out","rhs":{"value":["*","dim_d_prob_out_1","dim_d_prob_out_2"]}},{"name":"dim_d_prob_out_1","type":"expression_scalar","source":[25],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_d_prob_out_1","rhs":{"value":"n_hospitals"}},{"name":"dim_d_prob_out_2","type":"expression_scalar","source":[25],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_d_prob_out_2","rhs":{"value":"n_hospitals"}},{"name":"dim_I","type":"expression_scalar","source":[13],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_I","rhs":{"value":"n_hospitals"}},{"name":"dim_i_initial","type":"expression_scalar","source":[22],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_i_initial","rhs":{"value":"n_hospitals"}},{"name":"dim_I_temp","type":"expression_scalar","source":[17],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_I_temp","rhs":{"value":"n_hospitals"}},{"name":"dim_N","type":"expression_scalar","source":[14],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_N","rhs":{"value":"n_hospitals"}},{"name":"dim_new_I","type":"expression_scalar","source":[19],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_new_I","rhs":{"value":"n_hospitals"}},{"name":"dim_S","type":"expression_scalar","source":[12],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_S","rhs":{"value":"n_hospitals"}},{"name":"dim_s_initial","type":"expression_scalar","source":[21],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_s_initial","rhs":{"value":"n_hospitals"}},{"name":"dim_S_temp","type":"expression_scalar","source":[16],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_S_temp","rhs":{"value":"n_hospitals"}},{"name":"dim_t_I","type":"expression_scalar","source":[27],"depends":{"functions":[],"variables":["dim_t_I_1","dim_t_I_2"]},"lhs":"dim_t_I","rhs":{"value":["*","dim_t_I_1","dim_t_I_2"]}},{"name":"dim_t_I_1","type":"expression_scalar","source":[27],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_I_1","rhs":{"value":"n_hospitals"}},{"name":"dim_t_I_2","type":"expression_scalar","source":[27],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_I_2","rhs":{"value":"n_hospitals"}},{"name":"dim_t_I_out","type":"expression_scalar","source":[29],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_I_out","rhs":{"value":"n_hospitals"}},{"name":"dim_t_S","type":"expression_scalar","source":[26],"depends":{"functions":[],"variables":["dim_t_S_1","dim_t_S_2"]},"lhs":"dim_t_S","rhs":{"value":["*","dim_t_S_1","dim_t_S_2"]}},{"name":"dim_t_S_1","type":"expression_scalar","source":[26],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_S_1","rhs":{"value":"n_hospitals"}},{"name":"dim_t_S_2","type":"expression_scalar","source":[26],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_S_2","rhs":{"value":"n_hospitals"}},{"name":"dim_t_S_out","type":"expression_scalar","source":[28],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_S_out","rhs":{"value":"n_hospitals"}},{"name":"i_initial","type":"user","source":[8],"depends":{"functions":["length"],"variables":["dim_i_initial"]},"lhs":"i_initial","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"I_temp","type":"expression_array","source":[60],"depends":{"functions":["length","+","-","[","odin_sum","dim"],"variables":["dim_I_temp","I","i","t_I","dim_t_I","alloc_I_temp"]},"lhs":"I_temp","rhs":[{"index":[{"value":[":",1,["length","I_temp"]],"is_range":true,"index":"i"}],"value":["+",["-",["[","I","i"],["odin_sum","t_I","i","i",1,["dim","t_I",2]]],["odin_sum","t_I",1,["dim","t_I",1],"i","i"]]}]},{"name":"initial_I","type":"expression_array","source":[71],"depends":{"functions":["length","["],"variables":["dim_I","i_initial","i"]},"lhs":"initial_I","rhs":[{"index":[{"value":[":",1,["length","I"]],"is_range":true,"index":"i"}],"value":["[","i_initial","i"]}]},{"name":"initial_S","type":"expression_array","source":[70],"depends":{"functions":["length","["],"variables":["dim_S","s_initial","i"]},"lhs":"initial_S","rhs":[{"index":[{"value":[":",1,["length","S"]],"is_range":true,"index":"i"}],"value":["[","s_initial","i"]}]},{"name":"N","type":"expression_array","source":[36],"depends":{"functions":["length","+","["],"variables":["dim_N","S","i","I","alloc_N"]},"lhs":"N","rhs":[{"index":[{"value":[":",1,["length","N"]],"is_range":true,"index":"i"}],"value":["+",["[","S","i"],["[","I","i"]]}]},{"name":"n_hospitals","type":"user","source":[6],"depends":null,"lhs":"n_hospitals","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"new_I","type":"expression_array","source":[63],"depends":{"functions":["length","rbinom","[","-","exp","/","*"],"variables":["dim_new_I","S_temp","i","beta","I_temp","N","alloc_new_I"]},"lhs":"new_I","rhs":[{"index":[{"value":[":",1,["length","new_I"]],"is_range":true,"index":"i"}],"value":["rbinom",["[","S_temp","i"],["-",1,["exp",["/",["*",["-","beta"],["[","I_temp","i"]],["[","N","i"]]]]]}]},{"name":"output_new_I","type":"copy","source":[77],"depends":{"functions":[],"variables":["new_I"]},"lhs":"new_I"},{"name":"output_t_I","type":"copy","source":[78],"depends":{"functions":[],"variables":["t_I"]},"lhs":"t_I"},{"name":"s_initial","type":"user","source":[7],"depends":{"functions":["length"],"variables":["dim_s_initial"]},"lhs":"s_initial","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"S_temp","type":"expression_array","source":[59],"depends":{"functions":["length","+","-","[","odin_sum","dim"],"variables":["dim_S_temp","S","i","t_S","dim_t_S","alloc_S_temp"]},"lhs":"S_temp","rhs":[{"index":[{"value":[":",1,["length","S_temp"]],"is_range":true,"index":"i"}],"value":["+",["-",["[","S","i"],["odin_sum","t_S","i","i",1,["dim","t_S",2]]],["odin_sum","t_S",1,["dim","t_S",1],"i","i"]]}]},{"name":"t_I","type":"expression_array","source":[56],"depends":{"functions":["dim","-","["],"variables":["dim_t_I","d","i","j","t_S","alloc_t_I"]},"lhs":"t_I","rhs":[{"index":[{"value":[":",1,["dim","t_I",1]],"is_range":true,"index":"i"},{"value":[":",1,["dim","t_I",2]],"is_range":true,"index":"j"}],"value":["-",["[","d","i","j"],["[","t_S","i","j"]]}]},{"name":"t_I_out","type":"expression_array","source":[47],"depends":{"functions":["length","-","odin_sum","dim","["],"variables":["dim_t_I_out","d","i","dim_d","t_S_out","alloc_t_I_out"]},"lhs":"t_I_out","rhs":[{"index":[{"value":[":",1,["length","t_I_out"]],"is_range":true,"index":"i"}],"value":["-",["odin_sum","d","i","i",1,["dim","d",2]],["[","t_S_out","i"]]}]},{"name":"t_S","type":"expression_array","source":[53],"depends":{"functions":["dim","min","[","round","/","*"],"variables":["dim_t_S","S","i","d","j","N","alloc_t_S"]},"lhs":"t_S","rhs":[{"index":[{"value":[":",1,["dim","t_S",1]],"is_range":true,"index":"i"},{"value":[":",1,["dim","t_S",2]],"is_range":true,"index":"j"}],"value":["min",["[","S","i"],["round",["/",["*",["[","d","i","j"],["[","S","i"]],["[","N","i"]]]]}]},{"name":"t_S_out","type":"expression_array","source":[46],"depends":{"functions":["length","min","[","rbinom","odin_sum","dim","/"],"variables":["dim_t_S_out","S","i","d","dim_d","N","alloc_t_S_out"]},"lhs":"t_S_out","rhs":[{"index":[{"value":[":",1,["length","t_S_out"]],"is_range":true,"index":"i"}],"value":["min",["[","S","i"],["rbinom",["odin_sum","d","i","i",1,["dim","d",2]],["/",["[","S","i"],["[","N","i"]]]]}]},{"name":"update_I","type":"expression_array","source":[65],"depends":{"functions":["length","+","["],"variables":["dim_I","I_temp","i","new_I"]},"lhs":"I","rhs":[{"index":[{"value":[":",1,["length","I"]],"is_range":true,"index":"i"}],"value":["+",["[","I_temp","i"],["[","new_I","i"]]}]},{"name":"update_S","type":"expression_array","source":[64],"depends":{"functions":["length","-","["],"variables":["dim_S","S_temp","i","new_I"]},"lhs":"S","rhs":[{"index":[{"value":[":",1,["length","S"]],"is_range":true,"index":"i"}],"value":["-",["[","S_temp","i"],["[","new_I","i"]]}]}],"debug":[],"components":{"create":{"variables":[],"equations":[]},"user":{"variables":[],"equations":["beta","n_hospitals","dim_d_1","dim_d_2","dim_d_prob_out_1","dim_d_prob_out_2","dim_I","dim_i_initial","dim_I_temp","dim_N","dim_new_I","dim_S","dim_s_initial","dim_S_temp","dim_t_I_1","dim_t_I_2","dim_t_I_out","dim_t_S_1","dim_t_S_2","dim_t_S_out","alloc_I_temp","alloc_initial_I","alloc_initial_S","alloc_N","alloc_new_I","alloc_S_temp","alloc_t_I_out","alloc_t_S_out","dim_d","dim_d_prob_out","dim_t_I","dim_t_S","i_initial","s_initial","alloc_d_prob_out","alloc_t_I","alloc_t_S","d","initial_I","initial_S","d_prob_out"]},"initial":{"variables":[],"equations":[]},"rhs":{"variables":["S","I"],"equations":["N","t_S","S_temp","t_I","I_temp","new_I","update_I","update_S"]},"update_stochastic":{"variables":[],"equations":[]},"output":{"variables":["S","I"],"equations":["N","t_S","S_temp","t_I","I_temp","output_t_I","new_I","output_new_I"]}},"user":[{"name":"beta","has_default":false},{"name":"d","has_default":false},{"name":"i_initial","has_default":false},{"name":"n_hospitals","has_default":false},{"name":"s_initial","has_default":false}],"interpolate":{"min":[],"max":[],"critical":[]},"source":["##############################","# PARAMETERS","##############################","# User-specified parameters","beta <- user()","n_hospitals <- user()","s_initial[] <- user()","i_initial[] <- user()","d[,] <- user()","","# Dimension of variables","dim(S) <- n_hospitals","dim(I) <- n_hospitals","dim(N) <- n_hospitals","","dim(S_temp) <- n_hospitals","dim(I_temp) <- n_hospitals","","dim(new_I) <- n_hospitals","","dim(s_initial) <- n_hospitals","dim(i_initial) <- n_hospitals","","dim(d) <- c(n_hospitals, n_hospitals)","dim(d_prob_out) <- c(n_hospitals, n_hospitals)","dim(t_S) <- c(n_hospitals, n_hospitals)","dim(t_I) <- c(n_hospitals, n_hospitals)","dim(t_S_out) <- n_hospitals","dim(t_I_out) <- n_hospitals","","##############################","# MODEL","##############################","# 1. UPDATE INTERNAL PARAMETERS-------------","# Total population in each subpopulation i","N[] <- S[i] + I[i]","","# Probabilities of transferring out","d_prob_out[,] <- d[i,j] / sum(d[i,])","","# 1. TRAVEL STEP----------------------------","# t_S[,] <- rmultinom(1, S[i], d[i]/N[i])[,1]","# t_I[,] <- rmultinom(1, I[i], d[i]/N[i])[,1]","","# Number of susceptible and infected individuals moving out of each subpopulation","t_S_out[] <- min(S[i], rbinom(sum(d[i,]), S[i]/N[i]))","t_I_out[] <- sum(d[i,]) - t_S_out[i]","","# Distribution to the connected subpopulations","# t_S[,1] <- if (t_S_out[i] == sum(d[i,])) d[i,1] else rbinom(t_S_out[i], d_prob_out[i,1])","# t_S[,2:(n_hospitals-1)] <- if (t_S_out[i] == sum(d[i,])) d[i,j] else rbinom(t_S_out[i] - sum(t_S[i,1:(i-1)]), d_prob_out[i,j])","# t_S[,n_hospitals] <- t_S_out[i] - sum(t_S[i,1:(n_hospitals-1)])","t_S[,] <- min(S[i], round(d[i,j]*S[i]/N[i]))","","# Transferred infected individuals","t_I[,] <- d[i,j]-t_S[i,j]","","# Update compartments","S_temp[] <- S[i] - sum(t_S[i,]) + sum(t_S[,i])","I_temp[] <- I[i] - sum(t_I[i,]) + sum(t_I[,i])","","# 2. STEP EPIDEMICS--------------------------","new_I[] <- rbinom(S_temp[i], 1-exp(-beta*I_temp[i]/N[i]))","update(S[]) <- S_temp[i] - new_I[i]","update(I[]) <- I_temp[i] + new_I[i]","","##############################","# INITIAL CONDITIONS","##############################","initial(S[]) <- s_initial[i]","initial(I[]) <- i_initial[i]","","##############################","# ADDITIONNAL VARIABLES TO","# STORE AT EACH TIME STEP","##############################","output(new_I[]) <- TRUE","output(t_I[,]) <- TRUE"]}
