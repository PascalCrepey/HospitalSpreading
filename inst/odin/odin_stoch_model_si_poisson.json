{"version":"1.2.4","config":{"base":"odin_stoch_model_si_poisson","include":null,"custom":null},"meta":{"internal":"internal","user":"user","state":"state","result":"state_next","output":"output","time":"step","initial_time":"initial_step"},"features":{"discrete":true,"has_array":true,"has_output":true,"has_user":true,"has_delay":false,"has_interpolate":false,"has_stochastic":true,"has_include":false,"initial_time_dependent":false},"data":{"elements":[{"name":"beta","location":"internal","storage_type":"double","rank":0,"dimnames":null,"stage":"user"},{"name":"d","location":"internal","storage_type":"double","rank":2,"dimnames":{"length":"dim_d","dim":["dim_d_1","dim_d_2"],"mult":["","dim_d_1"]},"stage":"user"},{"name":"dim_d","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_d_1","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_d_2","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_I","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_i_initial","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_N","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_new_I","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_S","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_s_initial","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I_1","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I_2","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I_in","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_I_out","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S_1","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S_2","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S_in","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"dim_t_S_out","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"I","location":"variable","storage_type":"double","rank":1,"dimnames":{"length":"dim_I","dim":[],"mult":[]},"stage":"time"},{"name":"i_initial","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_i_initial","dim":[],"mult":[]},"stage":"user"},{"name":"initial_I","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_I","dim":[],"mult":[]},"stage":"user"},{"name":"initial_S","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_S","dim":[],"mult":[]},"stage":"user"},{"name":"N","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_N","dim":[],"mult":[]},"stage":"time"},{"name":"n_hospitals","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"new_I","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_new_I","dim":[],"mult":[]},"stage":"time"},{"name":"offset_output_t_I_in","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"offset_output_t_S_in","location":"internal","storage_type":"int","rank":0,"dimnames":null,"stage":"user"},{"name":"S","location":"variable","storage_type":"double","rank":1,"dimnames":{"length":"dim_S","dim":[],"mult":[]},"stage":"time"},{"name":"s_initial","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_s_initial","dim":[],"mult":[]},"stage":"user"},{"name":"t_I","location":"internal","storage_type":"double","rank":2,"dimnames":{"length":"dim_t_I","dim":["dim_t_I_1","dim_t_I_2"],"mult":["","dim_t_I_1"]},"stage":"time"},{"name":"t_I_in","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_t_I_in","dim":[],"mult":[]},"stage":"time"},{"name":"t_I_out","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_t_I_out","dim":[],"mult":[]},"stage":"time"},{"name":"t_S","location":"internal","storage_type":"double","rank":2,"dimnames":{"length":"dim_t_S","dim":["dim_t_S_1","dim_t_S_2"],"mult":["","dim_t_S_1"]},"stage":"time"},{"name":"t_S_in","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_t_S_in","dim":[],"mult":[]},"stage":"time"},{"name":"t_S_out","location":"internal","storage_type":"double","rank":1,"dimnames":{"length":"dim_t_S_out","dim":[],"mult":[]},"stage":"time"}],"variable":{"length":["+","dim_I","dim_S"],"contents":[{"name":"S","offset":0,"initial":"initial_S"},{"name":"I","offset":"dim_S","initial":"initial_I"}]},"output":{"length":["+",["+",["+","dim_t_I_in","dim_t_I_out"],"dim_t_S_in"],"dim_t_S_out"],"contents":[{"name":"t_S_out","offset":0},{"name":"t_I_out","offset":"dim_t_S_out"},{"name":"t_S_in","offset":"offset_output_t_S_in"},{"name":"t_I_in","offset":"offset_output_t_I_in"}]}},"equations":[{"name":"alloc_initial_I","type":"alloc","source":[41],"depends":{"functions":[],"variables":["dim_I"]},"lhs":"initial_I"},{"name":"alloc_initial_S","type":"alloc","source":[40],"depends":{"functions":[],"variables":["dim_S"]},"lhs":"initial_S"},{"name":"alloc_N","type":"alloc","source":[39],"depends":{"functions":[],"variables":["dim_N"]},"lhs":"N"},{"name":"alloc_new_I","type":"alloc","source":[42],"depends":{"functions":[],"variables":["dim_new_I"]},"lhs":"new_I"},{"name":"alloc_t_I","type":"alloc","source":[48],"depends":{"functions":[],"variables":["dim_t_I"]},"lhs":"t_I"},{"name":"alloc_t_I_in","type":"alloc","source":[54],"depends":{"functions":[],"variables":["dim_t_I_in"]},"lhs":"t_I_in"},{"name":"alloc_t_I_out","type":"alloc","source":[51],"depends":{"functions":[],"variables":["dim_t_I_out"]},"lhs":"t_I_out"},{"name":"alloc_t_S","type":"alloc","source":[47],"depends":{"functions":[],"variables":["dim_t_S"]},"lhs":"t_S"},{"name":"alloc_t_S_in","type":"alloc","source":[53],"depends":{"functions":[],"variables":["dim_t_S_in"]},"lhs":"t_S_in"},{"name":"alloc_t_S_out","type":"alloc","source":[50],"depends":{"functions":[],"variables":["dim_t_S_out"]},"lhs":"t_S_out"},{"name":"beta","type":"user","source":[27],"depends":null,"lhs":"beta","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"d","type":"user","source":[33],"depends":{"functions":["dim"],"variables":["dim_d"]},"lhs":"d","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"dim_d","type":"expression_scalar","source":[46],"depends":{"functions":[],"variables":["dim_d_1","dim_d_2"]},"lhs":"dim_d","rhs":{"value":["*","dim_d_1","dim_d_2"]}},{"name":"dim_d_1","type":"expression_scalar","source":[46],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_d_1","rhs":{"value":"n_hospitals"}},{"name":"dim_d_2","type":"expression_scalar","source":[46],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_d_2","rhs":{"value":"n_hospitals"}},{"name":"dim_I","type":"expression_scalar","source":[41],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_I","rhs":{"value":"n_hospitals"}},{"name":"dim_i_initial","type":"expression_scalar","source":[44],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_i_initial","rhs":{"value":"n_hospitals"}},{"name":"dim_N","type":"expression_scalar","source":[39],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_N","rhs":{"value":"n_hospitals"}},{"name":"dim_new_I","type":"expression_scalar","source":[42],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_new_I","rhs":{"value":"n_hospitals"}},{"name":"dim_S","type":"expression_scalar","source":[40],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_S","rhs":{"value":"n_hospitals"}},{"name":"dim_s_initial","type":"expression_scalar","source":[43],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_s_initial","rhs":{"value":"n_hospitals"}},{"name":"dim_t_I","type":"expression_scalar","source":[48],"depends":{"functions":[],"variables":["dim_t_I_1","dim_t_I_2"]},"lhs":"dim_t_I","rhs":{"value":["*","dim_t_I_1","dim_t_I_2"]}},{"name":"dim_t_I_1","type":"expression_scalar","source":[48],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_I_1","rhs":{"value":"n_hospitals"}},{"name":"dim_t_I_2","type":"expression_scalar","source":[48],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_I_2","rhs":{"value":"n_hospitals"}},{"name":"dim_t_I_in","type":"expression_scalar","source":[54],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_I_in","rhs":{"value":"n_hospitals"}},{"name":"dim_t_I_out","type":"expression_scalar","source":[51],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_I_out","rhs":{"value":"n_hospitals"}},{"name":"dim_t_S","type":"expression_scalar","source":[47],"depends":{"functions":[],"variables":["dim_t_S_1","dim_t_S_2"]},"lhs":"dim_t_S","rhs":{"value":["*","dim_t_S_1","dim_t_S_2"]}},{"name":"dim_t_S_1","type":"expression_scalar","source":[47],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_S_1","rhs":{"value":"n_hospitals"}},{"name":"dim_t_S_2","type":"expression_scalar","source":[47],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_S_2","rhs":{"value":"n_hospitals"}},{"name":"dim_t_S_in","type":"expression_scalar","source":[53],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_S_in","rhs":{"value":"n_hospitals"}},{"name":"dim_t_S_out","type":"expression_scalar","source":[50],"depends":{"functions":[],"variables":["n_hospitals"]},"lhs":"dim_t_S_out","rhs":{"value":"n_hospitals"}},{"name":"i_initial","type":"user","source":[32],"depends":{"functions":["length"],"variables":["dim_i_initial"]},"lhs":"i_initial","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"initial_I","type":"expression_array","source":[24],"depends":{"functions":["length","["],"variables":["dim_I","i_initial","i"]},"lhs":"initial_I","rhs":[{"index":[{"value":[":",1,["length","I"]],"is_range":true,"index":"i"}],"value":["[","i_initial","i"]}]},{"name":"initial_S","type":"expression_array","source":[23],"depends":{"functions":["length","["],"variables":["dim_S","s_initial","i"]},"lhs":"initial_S","rhs":[{"index":[{"value":[":",1,["length","S"]],"is_range":true,"index":"i"}],"value":["[","s_initial","i"]}]},{"name":"N","type":"expression_array","source":[3],"depends":{"functions":["length","+","["],"variables":["dim_N","S","i","I","alloc_N"]},"lhs":"N","rhs":[{"index":[{"value":[":",1,["length","N"]],"is_range":true,"index":"i"}],"value":["+",["[","S","i"],["[","I","i"]]}]},{"name":"n_hospitals","type":"user","source":[30],"depends":null,"lhs":"n_hospitals","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"new_I","type":"expression_array","source":[18],"depends":{"functions":["length","rpois","*","[","(","-","exp","/"],"variables":["dim_new_I","S","i","beta","I","N","alloc_new_I"]},"lhs":"new_I","rhs":[{"index":[{"value":[":",1,["length","new_I"]],"is_range":true,"index":"i"}],"value":["rpois",["*",["[","S","i"],["(",["-",1,["exp",["/",["*",["-","beta"],["[","I","i"]],["[","N","i"]]]]]]]}]},{"name":"offset_output_t_I_in","type":"expression_scalar","source":[],"depends":{"functions":["+"],"variables":["dim_t_I_out","dim_t_S_in","dim_t_S_out"]},"lhs":"offset_output_t_I_in","rhs":{"value":["+",["+","dim_t_I_out","dim_t_S_in"],"dim_t_S_out"]}},{"name":"offset_output_t_S_in","type":"expression_scalar","source":[],"depends":{"functions":["+"],"variables":["dim_t_I_out","dim_t_S_out"]},"lhs":"offset_output_t_S_in","rhs":{"value":["+","dim_t_I_out","dim_t_S_out"]}},{"name":"output_t_I_in","type":"copy","source":[61],"depends":{"functions":[],"variables":["t_I_in"]},"lhs":"t_I_in"},{"name":"output_t_I_out","type":"copy","source":[58],"depends":{"functions":[],"variables":["t_I_out"]},"lhs":"t_I_out"},{"name":"output_t_S_in","type":"copy","source":[60],"depends":{"functions":[],"variables":["t_S_in"]},"lhs":"t_S_in"},{"name":"output_t_S_out","type":"copy","source":[57],"depends":{"functions":[],"variables":["t_S_out"]},"lhs":"t_S_out"},{"name":"s_initial","type":"user","source":[31],"depends":{"functions":["length"],"variables":["dim_s_initial"]},"lhs":"s_initial","user":{"default":null,"dim":false,"min":null,"max":null}},{"name":"t_I","type":"expression_array","source":[7],"depends":{"functions":["dim","-","["],"variables":["dim_t_I","d","i","j","t_S","alloc_t_I"]},"lhs":"t_I","rhs":[{"index":[{"value":[":",1,["dim","t_I",1]],"is_range":true,"index":"i"},{"value":[":",1,["dim","t_I",2]],"is_range":true,"index":"j"}],"value":["-",["[","d","i","j"],["[","t_S","i","j"]]}]},{"name":"t_I_in","type":"expression_array","source":[15],"depends":{"functions":["length","odin_sum","dim"],"variables":["dim_t_I_in","t_I","dim_t_I","i","alloc_t_I_in"]},"lhs":"t_I_in","rhs":[{"index":[{"value":[":",1,["length","t_I_in"]],"is_range":true,"index":"i"}],"value":["odin_sum","t_I",1,["dim","t_I",1],"i","i"]}]},{"name":"t_I_out","type":"expression_array","source":[11],"depends":{"functions":["length","odin_sum","dim"],"variables":["dim_t_I_out","t_I","i","dim_t_I","alloc_t_I_out"]},"lhs":"t_I_out","rhs":[{"index":[{"value":[":",1,["length","t_I_out"]],"is_range":true,"index":"i"}],"value":["odin_sum","t_I","i","i",1,["dim","t_I",2]]}]},{"name":"t_S","type":"expression_array","source":[6],"depends":{"functions":["dim","rbinom","[","/"],"variables":["dim_t_S","d","i","j","S","N","alloc_t_S"]},"lhs":"t_S","rhs":[{"index":[{"value":[":",1,["dim","t_S",1]],"is_range":true,"index":"i"},{"value":[":",1,["dim","t_S",2]],"is_range":true,"index":"j"}],"value":["rbinom",["[","d","i","j"],["/",["[","S","i"],["[","N","i"]]]}]},{"name":"t_S_in","type":"expression_array","source":[14],"depends":{"functions":["length","odin_sum","dim"],"variables":["dim_t_S_in","t_S","dim_t_S","i","alloc_t_S_in"]},"lhs":"t_S_in","rhs":[{"index":[{"value":[":",1,["length","t_S_in"]],"is_range":true,"index":"i"}],"value":["odin_sum","t_S",1,["dim","t_S",1],"i","i"]}]},{"name":"t_S_out","type":"expression_array","source":[10],"depends":{"functions":["length","odin_sum","dim"],"variables":["dim_t_S_out","t_S","i","dim_t_S","alloc_t_S_out"]},"lhs":"t_S_out","rhs":[{"index":[{"value":[":",1,["length","t_S_out"]],"is_range":true,"index":"i"}],"value":["odin_sum","t_S","i","i",1,["dim","t_S",2]]}]},{"name":"update_I","type":"expression_array","source":[20],"depends":{"functions":["length","+","-","["],"variables":["dim_I","I","i","new_I","t_I_out","t_I_in"]},"lhs":"I","rhs":[{"index":[{"value":[":",1,["length","I"]],"is_range":true,"index":"i"}],"value":["+",["-",["+",["[","I","i"],["[","new_I","i"]],["[","t_I_out","i"]],["[","t_I_in","i"]]}]},{"name":"update_S","type":"expression_array","source":[19],"depends":{"functions":["length","+","-","["],"variables":["dim_S","S","i","new_I","t_S_out","t_S_in"]},"lhs":"S","rhs":[{"index":[{"value":[":",1,["length","S"]],"is_range":true,"index":"i"}],"value":["+",["-",["-",["[","S","i"],["[","new_I","i"]],["[","t_S_out","i"]],["[","t_S_in","i"]]}]}],"components":{"create":{"variables":[],"equations":[]},"user":{"variables":[],"equations":["beta","n_hospitals","dim_d_1","dim_d_2","dim_I","dim_i_initial","dim_N","dim_new_I","dim_S","dim_s_initial","dim_t_I_1","dim_t_I_2","dim_t_I_in","dim_t_I_out","dim_t_S_1","dim_t_S_2","dim_t_S_in","dim_t_S_out","alloc_initial_I","alloc_initial_S","alloc_N","alloc_new_I","alloc_t_I_in","alloc_t_I_out","alloc_t_S_in","alloc_t_S_out","dim_d","dim_t_I","dim_t_S","i_initial","offset_output_t_I_in","offset_output_t_S_in","s_initial","alloc_t_I","alloc_t_S","d","initial_I","initial_S"]},"initial":{"variables":[],"equations":[]},"rhs":{"variables":["S","I"],"equations":["N","new_I","t_S","t_I","t_S_in","t_S_out","t_I_in","t_I_out","update_S","update_I"]},"output":{"variables":["S","I"],"equations":["N","t_S","t_I","t_S_in","t_S_out","output_t_S_in","output_t_S_out","t_I_in","t_I_out","output_t_I_in","output_t_I_out"]}},"user":[{"name":"beta","has_default":false},{"name":"d","has_default":false},{"name":"i_initial","has_default":false},{"name":"n_hospitals","has_default":false},{"name":"s_initial","has_default":false}],"interpolate":{"min":[],"max":[],"critical":[]},"source":["","#Total population in each hospital i","N[] <- S[i] + I[i]","","#number of patients moving that are S or I","t_S[,] <- rbinom(d[i,j], S[i]/N[i])","t_I[,] <- d[i,j] - t_S[i,j]","","#Vectors of transfers out of hospitals","t_S_out[] <- sum(t_S[i,])","t_I_out[] <- sum(t_I[i,])","","#Vectors of transfers into hospitals","t_S_in[] <- sum(t_S[,i])","t_I_in[] <- sum(t_I[,i])","","#stochastic update","new_I[] <- rpois(S[i] * (1-exp(-beta*I[i]/N[i])))","update(S[]) <- S[i] - new_I[i] - t_S_out[i] + t_S_in[i]","update(I[]) <- I[i] + new_I[i] - t_I_out[i] + t_I_in[i]","","#Initial condition","initial(S[]) <- s_initial[i]","initial(I[]) <- i_initial[i]","","#parameters","beta <- user()","","#initialize user input","n_hospitals <- user()","s_initial[] <- user()","i_initial[] <- user()","d[,] <- user()","","#dimension of parameters","# dim(beta) #one dimension because beta is hospital-indepedent","","#dimension of compartments","dim(N) <- n_hospitals","dim(S) <- n_hospitals","dim(I) <- n_hospitals","dim(new_I) <- n_hospitals","dim(s_initial) <- n_hospitals","dim(i_initial) <- n_hospitals","","dim(d) <- c(n_hospitals, n_hospitals)","dim(t_S) <- c(n_hospitals, n_hospitals)","dim(t_I) <- c(n_hospitals, n_hospitals)","","dim(t_S_out) <- n_hospitals","dim(t_I_out) <- n_hospitals","","dim(t_S_in) <- n_hospitals","dim(t_I_in) <- n_hospitals","","# print variables at each time step","output(t_S_out[]) <- TRUE","output(t_I_out[]) <- TRUE","","output(t_S_in[]) <- TRUE","output(t_I_in[]) <- TRUE"]}
